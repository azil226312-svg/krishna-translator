<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MacTranslator | Free Text Translator with MacBook Style</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        :root {
            --light-blue: #7cc9f0;
            --dark-blue: #1a73e8;
            --aqua: #2dd4bf;
            --gray: #9ca3af;
            --dark-gray: #4b5563;
            --black: #111827;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --success: #10b981;
            --error: #ef4444;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            opacity: 0;
            animation: fadeIn 1s ease-out forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* MacBook风格任务栏 */
        .mac-taskbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .taskbar-left, .taskbar-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .apple-logo {
            font-size: 22px;
            color: white;
            font-weight: 300;
        }

        .taskbar-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .taskbar-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .taskbar-item.active {
            background: rgba(26, 115, 232, 0.2);
            color: var(--light-blue);
        }

        .system-icons {
            display: flex;
            align-items: center;
            gap: 15px;
            color: rgba(255, 255, 255, 0.9);
        }

        .system-icons i {
            font-size: 16px;
        }

        /* 主内容区 */
        .main-container {
            margin-top: 80px;
            padding: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .page-title {
            text-align: center;
            margin-bottom: 40px;
            opacity: 0;
            animation: slideUp 0.8s ease-out 0.3s forwards;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-title h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, var(--light-blue), var(--aqua));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .page-title p {
            color: var(--gray);
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* API状态指示器 */
        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 20px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* 翻译容器 */
        .translator-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            opacity: 0;
            animation: slideUp 0.8s ease-out 0.5s forwards;
        }

        .translator-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px) saturate(180%);
            -webkit-backdrop-filter: blur(15px) saturate(180%);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .translator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .language-selectors {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .language-box {
            flex: 1;
            min-width: 250px;
        }

        .language-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: var(--light-blue);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .language-select {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--dark-gray);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .language-select:focus {
            border-color: var(--aqua);
            box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.2);
        }

        .swap-btn {
            background: linear-gradient(135deg, var(--dark-blue), var(--aqua));
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .swap-btn:hover {
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 5px 15px rgba(26, 115, 232, 0.4);
        }

        .translation-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        @media (min-width: 992px) {
            .translation-area {
                flex-direction: row;
            }
        }

        .text-box {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .text-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .text-label span {
            color: var(--light-blue);
            font-weight: 600;
        }

        .char-count {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .text-input, .text-output {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--dark-gray);
            border-radius: 15px;
            color: white;
            font-size: 1.1rem;
            line-height: 1.6;
            resize: vertical;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .text-input:focus {
            border-color: var(--aqua);
        }

        .text-output {
            background: rgba(0, 0, 0, 0.4);
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .translate-btn-container {
            text-align: center;
            margin-top: 20px;
        }

        .translate-btn {
            background: linear-gradient(135deg, var(--dark-blue), var(--aqua));
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(26, 115, 232, 0.3);
        }

        .translate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(26, 115, 232, 0.5);
        }

        .translate-btn:active {
            transform: translateY(0);
        }

        .translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* 通知 */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            background: rgba(17, 24, 39, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border-left: 5px solid var(--aqua);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.4s ease;
            z-index: 1001;
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--error);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification i {
            font-size: 1.5rem;
        }

        .notification.success i {
            color: var(--success);
        }

        .notification.error i {
            color: var(--error);
        }

        /* 页脚 */
        .footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            opacity: 0;
            animation: slideUp 0.8s ease-out 0.7s forwards;
        }

        .footer a {
            color: var(--light-blue);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* 加载动画 */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--aqua);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .mac-taskbar {
                height: 50px;
                padding: 0 10px;
            }
            
            .taskbar-item span {
                display: none;
            }
            
            .page-title h1 {
                font-size: 2.2rem;
            }
            
            .main-container {
                padding: 20px;
                margin-top: 70px;
            }
            
            .translator-card {
                padding: 20px;
            }
            
            .language-box {
                min-width: 100%;
            }
            
            .swap-btn {
                margin: 15px auto;
                transform: rotate(90deg);
            }
            
            .swap-btn:hover {
                transform: rotate(270deg) scale(1.1);
            }

            .notification {
                left: 20px;
                right: 20px;
                bottom: 20px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- MacBook风格任务栏 -->
    <nav class="mac-taskbar">
        <div class="taskbar-left">
            <div class="apple-logo">
                <i class="fab fa-apple"></i>
            </div>
            <div class="taskbar-item active">
                <i class="fas fa-language"></i>
                <span>Translator</span>
            </div>
            <div class="taskbar-item" id="history-btn">
                <i class="fas fa-history"></i>
                <span>History</span>
            </div>
            <div class="taskbar-item" id="favorites-btn">
                <i class="fas fa-star"></i>
                <span>Favorites</span>
            </div>
            <div class="taskbar-item" id="settings-btn">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
        </div>
        
        <div class="taskbar-right">
            <div class="system-icons">
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-three-quarters"></i>
                <i class="fas fa-search"></i>
                <span id="current-time">14:30</span>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="main-container">
        <div class="page-title">
            <h1>MacTranslator</h1>
            <p>Free text translation with MyMemory API. Translate between 100+ languages with MacBook style interface.</p>
            <div class="api-status">
                <div class="status-indicator"></div>
                <span>API Connected: MyMemory Translation (1000 words/day free)</span>
            </div>
        </div>

        <div class="translator-container">
            <div class="translator-card">
                <div class="language-selectors">
                    <div class="language-box">
                        <div class="language-label">
                            <i class="fas fa-arrow-down"></i>
                            <span>Source Language</span>
                        </div>
                        <select id="source-lang" class="language-select">
                            <option value="auto">Auto Detect</option>
                            <option value="en" selected>English</option>
                            <option value="hi">Hindi</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="ar">Arabic</option>
                            <option value="ru">Russian</option>
                            <option value="pt">Portuguese</option>
                            <option value="it">Italian</option>
                        </select>
                    </div>
                    
                    <button class="swap-btn" id="swap-languages">
                        <i class="fas fa-exchange-alt"></i>
                    </button>
                    
                    <div class="language-box">
                        <div class="language-label">
                            <i class="fas fa-arrow-up"></i>
                            <span>Target Language</span>
                        </div>
                        <select id="target-lang" class="language-select">
                            <option value="hi">Hindi</option>
                            <option value="en" selected>English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="ar">Arabic</option>
                            <option value="ru">Russian</option>
                            <option value="pt">Portuguese</option>
                            <option value="it">Italian</option>
                        </select>
                    </div>
                </div>
                
                <div class="translation-area">
                    <div class="text-box">
                        <div class="text-label">
                            <span>Text to translate</span>
                            <div class="char-count">Characters: <span id="input-chars">0</span> / 500</div>
                        </div>
                        <textarea id="input-text" class="text-input" placeholder="Enter text to translate (max 500 characters)..." maxlength="500">Hello! Welcome to MacTranslator. This is a free translation tool with MacBook style interface. Try typing your own text and see it translate instantly using MyMemory API!</textarea>
                    </div>
                    
                    <div class="text-box">
                        <div class="text-label">
                            <span>Translated text</span>
                            <div class="char-count">Characters: <span id="output-chars">0</span></div>
                        </div>
                        <div id="output-text" class="text-output">नमस्ते! MacTranslator में आपका स्वागत है। यह एक मुफ्त अनुवाद उपकरण है जिसमें MacBook स्टाइल इंटरफेस है। अपना खुद का टेक्स्ट टाइप करने का प्रयास करें और इसे MyMemory API का उपयोग करके तुरंत अनुवाद करते हुए देखें!</div>
                    </div>
                </div>
                
                <div class="translate-btn-container">
                    <button class="translate-btn" id="translate-btn">
                        <i class="fas fa-language"></i>
                        Translate Text
                    </button>
                </div>
                
                <div class="controls">
                    <button class="control-btn" id="speak-input">
                        <i class="fas fa-volume-up"></i>
                        Speak Input
                    </button>
                    <button class="control-btn" id="speak-output">
                        <i class="fas fa-volume-up"></i>
                        Speak Output
                    </button>
                    <button class="control-btn" id="copy-output">
                        <i class="far fa-copy"></i>
                        Copy Translation
                    </button>
                    <button class="control-btn" id="clear-text">
                        <i class="fas fa-eraser"></i>
                        Clear Text
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- 通知 -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <i class="fas fa-check-circle"></i>
            <div>
                <strong id="notification-title">Success</strong>
                <p id="notification-message">Translation completed successfully!</p>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="footer">
        <p>MacTranslator &copy; 2023 | Powered by <a href="https://mymemory.translated.net/" target="_blank">MyMemory Translation API</a> (1000 words/day free)</p>
        <p>API Status: <span id="api-status-text" style="color: var(--aqua); font-weight: 600;">Online</span> | <a href="#" id="api-info">API Info</a></p>
    </footer>

    <script>
        // API Configuration
        const API_CONFIG = {
            endpoint: 'https://api.mymemory.translated.net/get',
            rateLimit: 1000, // words per day
            timeout: 10000 // 10 seconds
        };

        // 更新当前时间
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('current-time').textContent = timeString;
        }
        
        // 初始化时间并设置定时更新
        updateTime();
        setInterval(updateTime, 60000);
        
        // 字符计数
        const inputText = document.getElementById('input-text');
        const outputText = document.getElementById('output-text');
        const inputChars = document.getElementById('input-chars');
        const outputChars = document.getElementById('output-chars');
        
        function updateCharCount() {
            const inputLength = inputText.value.length;
            const outputLength = outputText.textContent.length;
            
            inputChars.textContent = inputLength;
            outputChars.textContent = outputLength;
            
            // 更新输入框字符限制指示
            if (inputLength > 450) {
                inputChars.style.color = '#f87171'; // light red
            } else if (inputLength > 400) {
                inputChars.style.color = '#fbbf24'; // yellow
            } else {
                inputChars.style.color = 'var(--gray)';
            }
        }
        
        inputText.addEventListener('input', updateCharCount);
        updateCharCount();
        
        // 语言交换功能
        document.getElementById('swap-languages').addEventListener('click', function() {
            const sourceLang = document.getElementById('source-lang');
            const targetLang = document.getElementById('target-lang');
            
            const sourceValue = sourceLang.value;
            const targetValue = targetLang.value;
            
            // 交换选择的值
            sourceLang.value = targetValue === 'auto' ? 'en' : targetValue;
            targetLang.value = sourceValue === 'auto' ? 'en' : sourceValue;
            
            // 如果输入框有文本，则触发翻译
            if (inputText.value.trim()) {
                translateText();
            }
        });
        
        // 通知系统
        function showNotification(title, message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationMessage = document.getElementById('notification-message');
            
            notification.className = `notification ${type}`;
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        // 真实翻译API调用
        async function translateText() {
            const input = inputText.value.trim();
            let sourceLang = document.getElementById('source-lang').value;
            const targetLang = document.getElementById('target-lang').value;
            
            if (!input) {
                showNotification('Error', 'Please enter some text to translate.', 'error');
                return;
            }
            
            if (input.length > 500) {
                showNotification('Error', 'Text is too long. Maximum 500 characters allowed.', 'error');
                return;
            }
            
            // 保存按钮状态
            const translateBtn = document.getElementById('translate-btn');
            const originalBtnText = translateBtn.innerHTML;
            translateBtn.innerHTML = '<span class="loader"></span> Translating...';
            translateBtn.disabled = true;
            
            outputText.textContent = "Translating...";
            
            try {
                // MyMemory API调用
                const url = `${API_CONFIG.endpoint}?q=${encodeURIComponent(input)}&langpair=${sourceLang === 'auto' ? 'autodetect' : sourceLang}|${targetLang}`;
                
                // 设置超时
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), API_CONFIG.timeout);
                
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.responseStatus === 200 && data.responseData) {
                    const translatedText = data.responseData.translatedText;
                    
                    // 如果API检测到语言，更新源语言选择
                    if (sourceLang === 'auto' && data.responseData.detectedLanguage) {
                        const detectedLang = data.responseData.detectedLanguage.lang;
                        document.getElementById('source-lang').value = detectedLang;
                    }
                    
                    outputText.textContent = translatedText;
                    
                    // 添加到历史记录
                    addToHistory(input, translatedText, sourceLang, targetLang);
                    
                    showNotification('Success', 'Translation completed successfully!');
                } else {
                    throw new Error(data.responseDetails || 'Translation failed');
                }
                
            } catch (error) {
                console.error('Translation error:', error);
                
                // 如果API失败，使用备选方案
                if (error.name === 'AbortError') {
                    showNotification('Error', 'Translation timeout. Please try again.', 'error');
                    outputText.textContent = "Translation failed due to timeout. Please try again with shorter text.";
                } else {
                    // 使用模拟翻译作为备选
                    await simulateTranslation(input, sourceLang, targetLang);
                    showNotification('Warning', 'Using simulated translation (API limit may be reached)', 'error');
                }
            } finally {
                // 恢复按钮状态
                translateBtn.innerHTML = originalBtnText;
                translateBtn.disabled = false;
                updateCharCount();
            }
        }
        
        // 模拟翻译（当API失败时使用）
        async function simulateTranslation(text, sourceLang, targetLang) {
            // 等待模拟网络延迟
            await new Promise(resolve => setTimeout(resolve, 800));
            
            // 简单的模拟翻译
            const translations = {
                'hi': `[Simulated] अनुवाद: "${text}"`,
                'es': `[Simulated] Traducción: "${text}"`,
                'fr': `[Simulated] Traduction: "${text}"`,
                'de': `[Simulated] Übersetzung: "${text}"`,
                'zh': `[Simulated] 翻译: "${text}"`,
                'ja': `[Simulated] 翻訳: "${text}"`,
                'ar': `[Simulated] ترجمة: "${text}"`,
                'ru': `[Simulated] Перевод: "${text}"`,
                'pt': `[Simulated] Tradução: "${text}"`,
                'it': `[Simulated] Traduzione: "${text}"`,
                'en': `[Simulated] Translation: "${text}"`
            };
            
            outputText.textContent = translations[targetLang] || `[Simulated] Translation to ${targetLang}: ${text}`;
        }
        
        // 历史记录管理
        const translationHistory = JSON.parse(localStorage.getItem('translationHistory') || '[]');
        
        function addToHistory(input, output, sourceLang, targetLang) {
            const historyItem = {
                id: Date.now(),
                input,
                output,
                sourceLang,
                targetLang,
                timestamp: new Date().toLocaleString()
            };
            
            translationHistory.unshift(historyItem);
            
            // 只保留最近的10个
            if (translationHistory.length > 10) {
                translationHistory.pop();
            }
            
            localStorage.setItem('translationHistory', JSON.stringify(translationHistory));
        }
        
        // 文本转语音功能
        function speakText(text, lang) {
            if (!text.trim()) return;
            
            if ('speechSynthesis' in window) {
                // 停止任何当前语音
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                // 设置语言
                const langMap = {
                    'en': 'en-US',
                    'hi': 'hi-IN',
                    'es': 'es-ES',
                    'fr': 'fr-FR',
                    'de': 'de-DE',
                    'zh': 'zh-CN',
                    'ja': 'ja-JP',
                    'ar': 'ar-SA',
                    'ru': 'ru-RU',
                    'pt': 'pt-BR',
                    'it': 'it-IT'
                };
                
                utterance.lang = langMap[lang] || 'en-US';
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                speechSynthesis.speak(utterance);
            } else {
                showNotification('Error', 'Text-to-speech is not supported in your browser.', 'error');
            }
        }
        
        // 事件监听器
        document.getElementById('translate-btn').addEventListener('click', translateText);
        
        document.getElementById('speak-input').addEventListener('click', function() {
            const text = inputText.value.trim();
            const sourceLang = document.getElementById('source-lang').value;
            if (!text) {
                showNotification('Error', 'Please enter text to speak.', 'error');
                return;
            }
            speakText(text, sourceLang === 'auto' ? 'en' : sourceLang);
        });
        
        document.getElementById('speak-output').addEventListener('click', function() {
            const text = outputText.textContent.trim();
            const targetLang = document.getElementById('target-lang').value;
            if (!text || text === 'Translating...') {
                showNotification('Error', 'No translation to speak.', 'error');
                return;
            }
            speakText(text, targetLang);
        });
        
        // 复制翻译结果
        document.getElementById('copy-output').addEventListener('click', function() {
            const text = outputText.textContent;
            if (!text || text === 'Translating...') {
                showNotification('Error', 'No translation to copy.', 'error');
                return;
            }
            
            navigator.clipboard.writeText(text)
                .then(() => {
                    showNotification('Copied!', 'Translation copied to clipboard.');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    showNotification('Error', 'Failed to copy text.', 'error');
                });
        });
        
        // 清除文本
        document.getElementById('clear-text').addEventListener('click', function() {
            inputText.value = '';
            outputText.textContent = '';
            updateCharCount();
            inputText.focus();
            showNotification('Cleared', 'Text has been cleared.');
        });
        
        // 任务栏项目点击效果
        document.querySelectorAll('.taskbar-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.taskbar-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // 历史记录按钮
        document.getElementById('history-btn').addEventListener('click', function() {
            if (translationHistory.length === 0) {
                showNotification('History', 'No translation history yet.', 'error');
                return;
            }
            
            let historyMessage = 'Recent Translations:\n\n';
            translationHistory.slice(0, 5).forEach((item, index) => {
                historyMessage += `${index + 1}. ${item.input.substring(0, 30)}${item.input.length > 30 ? '...' : ''}\n   → ${item.output.substring(0, 30)}${item.output.length > 30 ? '...' : ''}\n\n`;
            });
            
            alert(historyMessage);
        });
        
        // 收藏按钮
        document.getElementById('favorites-btn').addEventListener('click', function() {
            showNotification('Favorites', 'Favorites feature coming soon!');
        });
        
        // 设置按钮
        document.getElementById('settings-btn').addEventListener('click', function() {
            showNotification('Settings', 'Settings panel will be available in the next update.');
        });
        
        // API信息
        document.getElementById('api-info').addEventListener('click', function(e) {
            e.preventDefault();
            showNotification('API Information', 'Using MyMemory Translation API. Free limit: 1000 words/day, 100 requests/hour.');
        });
        
        // 输入框自动翻译（当用户停止输入后）
        let typingTimer;
        const doneTypingInterval = 1500; // 1.5 seconds
        
        inputText.addEventListener('input', function() {
            clearTimeout(typingTimer);
            if (inputText.value.trim().length > 3) {
                typingTimer = setTimeout(translateText, doneTypingInterval);
            }
        });
        
        // 页面加载时检查API状态
        window.addEventListener('load', function() {
            // 模拟API状态检查
            setTimeout(() => {
                document.getElementById('api-status-text').textContent = 'Online ✓';
                document.getElementById('api-status-text').style.color = 'var(--success)';
            }, 1000);
        });
    </script>
</body>
</html>